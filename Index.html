<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indrasha - Environmental Intelligence</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.2.0/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            background: #f8f9fa;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-error { background: #dc3545; }

        .nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav button {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav button:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
        }

        .metric-value {
            font-size: 2.2em;
            font-weight: 700;
            color: #3498db;
            text-align: center;
            margin: 10px 0;
        }

        .metric-unit {
            font-size: 0.9em;
            color: #7f8c8d;
            text-align: center;
        }

        .prediction-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .controls-section {
            margin-top: 30px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .control-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .api-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .ml-insights {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .ml-insights h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .insight-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .insight-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .data-refresh {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .data-refresh:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .data-refresh.rotating {
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* AI Assistant Styles */
        .ai-assistant {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        .ai-button {
            background: linear-gradient(135deg, #024726 0%, #4ba283 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .ai-button:hover {
            transform: scale(1.1);
        }

        .ai-button.listening::before {
            content: '';
            position: absolute;
            border: 2px solid #4ba283;
            border-radius: 50%;
            width: 100%;
            height: 100%;
            animation: pulse 1.5s infinite;
        }

        .ai-chat-container {
            position: absolute;
            bottom: 80px;
            left: 0;
            width: 350px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            max-height: 500px;
            overflow: hidden;
        }

        .ai-chat-container.open {
            display: flex;
        }

        .ai-chat-header {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .ai-message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message.user {
            background: #e3f2fd;
            margin-left: auto;
            border-radius: 10px 10px 0 10px;
        }

        .ai-message.assistant {
            background: white;
            margin-right: auto;
            border-radius: 10px 10px 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .ai-chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
            background: white;
            border-radius: 0 0 15px 15px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .ai-chat-input button {
            margin-left: 10px;
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-chat-input button:hover {
            background: #5a67d8;
        }

        .ai-chat-input button.mic-btn {
            background: #dc3545;
            width: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-chat-input button.mic-btn:hover {
            background: #c82333;
        }

        .ai-chat-input button.mic-btn.listening {
            animation: pulse 1.5s infinite;
        }

        .ai-typing {
            display: flex;
            align-items: center;
            padding: 5px 15px;
            color: #666;
            font-size: 0.9em;
        }

        .ai-typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .ai-typing-dot:nth-child(1) { animation-delay: 0s; }
        .ai-typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .ai-typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .ai-suggestion {
            margin: 5px 0;
            padding: 8px 12px;
            background: #f0f4f8;
            border-radius: 15px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-suggestion:hover {
            background: #e0e7f0;
        }

        /* Region Selector */
        .region-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .region-selector select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: white;
            min-width: 200px;
        }

        .region-selector button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .region-selector button:hover {
            background: #5a67d8;
        }

        /* Time Period Selector */
        .time-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .time-selector button {
            padding: 8px 16px;
            background: #f8f9fa;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-selector button.active {
            background: #667eea;
            color: white;
        }

        /* AI Avatar Animation */
        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #024726 0%, #4ba283 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 10px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Map Visualization */
        .map-container {
            height: 300px;
            background: #f0f4f8;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .map-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e0e7ff 0%, #d1d5db 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #4b5563;
        }

        .map-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #dc3545;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            left: 50%;
            top: 50%;
            margin: -20px 0 0 -10px;
        }

        .map-marker::after {
            content: '';
            width: 10px;
            height: 10px;
            background: white;
            position: absolute;
            border-radius: 50%;
            top: 5px;
            left: 5px;
        }

        /* Enhanced AI Assistant Features */
        .ai-message.assistant .ai-response-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .ai-message.assistant .ai-response-header .ai-avatar {
            width: 30px;
            height: 30px;
            font-size: 0.8em;
        }

        .ai-message.assistant .ai-response-header span {
            font-weight: bold;
            color: #2c3e50;
        }

        .ai-message.assistant .ai-response-content {
            margin-left: 40px;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f0f4f8;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-chat-container {
                width: 300px;
                max-height: 70vh;
                bottom: 70px;
            }
            
            .region-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌍 Indrasha - Environmental Intelligence</h1>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-indicator status-active"></div>
                    <span>API Connected</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator status-active"></div>
                    <span>AI/ML Models Active</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator status-warning"></div>
                    <span>3 Active Alerts</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator status-active"></div>
                    <span>Last Update: <span id="last-update">Just now</span></span>
                </div>
            </div>
        </div>

        <nav class="nav">
            <button class="active" onclick="switchTab('dashboard')">Dashboard</button>
            <button onclick="switchTab('air-quality')">Air Quality</button>
            <button onclick="switchTab('water-quality')">Water Quality</button>
            <button onclick="switchTab('predictions')">AI Predictions</button>
            <button onclick="switchTab('controls')">Controls</button>
            <button onclick="switchTab('reports')">Reports</button>
        </nav>

        <div id="dashboard" class="tab-content active">
            <div class="region-selector">
                <select id="country-select" onchange="loadRegions('country')">
                    <option value="">Select Country</option>
                    <option value="US" selected>United States</option>
                    <option value="IN">India</option>
                    <option value="UK">United Kingdom</option>
                    <option value="DE">Germany</option>
                    <option value="JP">Japan</option>
                </select>
                <select id="state-select" onchange="loadRegions('state')">
                    <option value="">Select State</option>
                    <option value="CA" selected>California</option>
                    <option value="NY">New York</option>
                    <option value="TX">Texas</option>
                    <option value="FL">Florida</option>
                </select>
                <select id="city-select">
                    <option value="">Select City</option>
                    <option value="LA" selected>Los Angeles</option>
                    <option value="SF">San Francisco</option>
                    <option value="SD">San Diego</option>
                </select>
                <button onclick="loadRegionData()">Load Data</button>
            </div>

            <div class="api-status">
                <div class="api-indicator"></div>
                <span>Real-time data streaming from environmental sensors in Los Angeles, CA</span>
            </div>

            <div class="map-container">
                <div class="map-placeholder">
                    <i class="fas fa-map-marker-alt" style="font-size: 2em; margin-bottom: 10px;"></i>
                    <p>Environmental Monitoring Map View</p>
                    <div class="map-marker"></div>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Air Quality Index</div>
                        <div class="prediction-badge">AI Predicted</div>
                    </div>
                    <div class="metric-value" id="aqi-value">72</div>
                    <div class="metric-unit">AQI (Moderate)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Water Quality Index</div>
                        <div class="prediction-badge">Live Data</div>
                    </div>
                    <div class="metric-value" id="wqi-value">94</div>
                    <div class="metric-unit">WQI (Excellent)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">PM2.5 Concentration</div>
                        <div class="prediction-badge">Trending</div>
                    </div>
                    <div class="metric-value" id="pm25-value">35</div>
                    <div class="metric-unit">μg/m³</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Temperature</div>
                        <div class="prediction-badge">Live</div>
                    </div>
                    <div class="metric-value" id="temp-value">24.5</div>
                    <div class="metric-unit">°C</div>
                </div>
            </div>

            <div class="alert alert-warning">
                <strong>⚠️ AI Alert:</strong> PM2.5 levels predicted to increase by 15% in the next 2 hours due to traffic pattern analysis.
            </div>

            <div class="ml-insights">
                <h3>🤖 AI/ML Insights</h3>
                <div class="insight-item">
                    <div class="insight-icon">📊</div>
                    <div>Machine learning model predicts air quality will improve by 20% tomorrow based on weather patterns</div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">🔍</div>
                    <div>Anomaly detection: Water pH levels show unusual pattern - investigating potential cause</div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">📈</div>
                    <div>Trend analysis: NO₂ levels correlate strongly with traffic data (R² = 0.87)</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="realtime-chart"></canvas>
            </div>
        </div>

        <div id="air-quality" class="tab-content">
            <h2>Air Quality Monitoring</h2>
            
            <div class="region-selector">
                <select id="air-country-select" onchange="loadRegions('air-country')">
                    <option value="">Select Country</option>
                    <option value="US" selected>United States</option>
                    <option value="IN">India</option>
                    <option value="UK">United Kingdom</option>
                </select>
                <select id="air-state-select" onchange="loadRegions('air-state')">
                    <option value="">Select State</option>
                    <option value="CA" selected>California</option>
                    <option value="NY">New York</option>
                </select>
                <select id="air-city-select">
                    <option value="">Select City</option>
                    <option value="LA" selected>Los Angeles</option>
                    <option value="SF">San Francisco</option>
                </select>
                <button onclick="loadAirQualityData()">Load Data</button>
            </div>
            
            <div class="time-selector">
                <button class="active" onclick="changeTimePeriod('24h')">Today</button>
                <button onclick="changeTimePeriod('7d')">7 Days</button>
                <button onclick="changeTimePeriod('30d')">30 Days</button>
                <button onclick="changeTimePeriod('90d')">90 Days</button>
                <button onclick="changeTimePeriod('1y')">1 Year</button>
            </div>

            <div class="api-status">
                <div class="api-indicator"></div>
                <span>Connected to EPA Air Quality API & Local Sensors</span>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">PM2.5</div>
                    <div class="metric-value" id="air-pm25">35</div>
                    <div class="metric-unit">μg/m³</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Ozone (O₃)</div>
                    <div class="metric-value" id="air-o3">0.045</div>
                    <div class="metric-unit">ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">NO₂</div>
                    <div class="metric-value" id="air-no2">0.030</div>
                    <div class="metric-unit">ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">CO</div>
                    <div class="metric-value" id="air-co">0.5</div>
                    <div class="metric-unit">ppm</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="air-trend-chart"></canvas>
            </div>
            
            <h3 style="margin-top: 30px;">Historical Data</h3>
            <div class="chart-container">
                <canvas id="air-history-chart"></canvas>
            </div>
            
            <h3 style="margin-top: 30px;">Pollutant Comparison</h3>
            <div class="chart-container">
                <canvas id="air-comparison-chart"></canvas>
            </div>
        </div>

        <div id="water-quality" class="tab-content">
            <h2>Water Quality Monitoring</h2>
            
            <div class="region-selector">
                <select id="water-country-select" onchange="loadRegions('water-country')">
                    <option value="">Select Country</option>
                    <option value="US" selected>United States</option>
                    <option value="IN">India</option>
                </select>
                <select id="water-state-select" onchange="loadRegions('water-state')">
                    <option value="">Select State</option>
                    <option value="CA" selected>California</option>
                    <option value="FL">Florida</option>
                </select>
                <select id="water-city-select">
                    <option value="">Select City</option>
                    <option value="LA" selected>Los Angeles</option>
                    <option value="SD">San Diego</option>
                </select>
                <button onclick="loadWaterQualityData()">Load Data</button>
            </div>
            
            <div class="time-selector">
                <button class="active" onclick="changeTimePeriod('24h')">Today</button>
                <button onclick="changeTimePeriod('7d')">7 Days</button>
                <button onclick="changeTimePeriod('30d')">30 Days</button>
                <button onclick="changeTimePeriod('90d')">90 Days</button>
            </div>

            <div class="api-status">
                <div class="api-indicator"></div>
                <span>Connected to Water Quality Sensors & USGS API</span>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">pH Level</div>
                    <div class="metric-value" id="water-ph">7.2</div>
                    <div class="metric-unit">pH</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Dissolved Oxygen</div>
                    <div class="metric-value" id="water-do">8.5</div>
                    <div class="metric-unit">mg/L</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Turbidity</div>
                    <div class="metric-value" id="water-turbidity">1.8</div>
                    <div class="metric-unit">NTU</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Temperature</div>
                    <div class="metric-value" id="water-temp">22.1</div>
                    <div class="metric-unit">°C</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="water-trend-chart"></canvas>
            </div>
            
            <h3 style="margin-top: 30px;">Historical Data</h3>
            <div class="chart-container">
                <canvas id="water-history-chart"></canvas>
            </div>
        </div>

        <div id="predictions" class="tab-content">
            <h2>AI/ML Predictions & Analytics</h2>
            
            <div class="alert alert-success">
                <strong>🤖 Model Status:</strong> All AI models are running optimally. Last training: 2 hours ago.
            </div>

            <div class="ml-insights">
                <h3>Predictive Models</h3>
                <div class="insight-item">
                    <div class="insight-icon">🔮</div>
                    <div><strong>Air Quality Forecast:</strong> LSTM model predicts AQI will drop to 65 by evening</div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">🌊</div>
                    <div><strong>Water Quality Trend:</strong> Random Forest model shows 95% confidence in stable conditions</div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">⚡</div>
                    <div><strong>Anomaly Detection:</strong> Autoencoder detected unusual CO pattern at 14:30</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="prediction-chart"></canvas>
            </div>
            
            <h3 style="margin-top: 30px;">Model Performance Metrics</h3>
            <div class="chart-container">
                <canvas id="model-performance-chart"></canvas>
            </div>
            
            <h3 style="margin-top: 30px;">Feature Importance</h3>
            <div class="chart-container">
                <canvas id="feature-importance-chart"></canvas>
            </div>
        </div>

        <div id="controls" class="tab-content">
            <h2>System Controls</h2>
            <div class="controls-section">
                <div class="controls-grid">
                    <div class="control-card">
                        <h3>Air Quality Systems</h3>
                        <div class="control-item">
                            <span>Air Purification</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleControl(this, 'Air Purification')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="control-item">
                            <span>Ventilation Control</span>
                            <label class="switch">
                                <input type="checkbox" onchange="toggleControl(this, 'Ventilation Control')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="control-item">
                            <span>Smart Filtration</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleControl(this, 'Smart Filtration')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <h3>Water Treatment</h3>
                        <div class="control-item">
                            <span>Filtration System</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleControl(this, 'Filtration System')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="control-item">
                            <span>pH Adjustment</span>
                            <label class="switch">
                                <input type="checkbox" onchange="toggleControl(this, 'pH Adjustment')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="control-item">
                            <span>Disinfection</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleControl(this, 'Disinfection')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <h3>Monitoring Systems</h3>
                        <div class="control-item">
                            <span>Real-time Alerts</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleControl(this, 'Real-time Alerts')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="control-item">
                            <span>Predictive Analysis</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleControl(this, 'Predictive Analysis')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="control-item">
                            <span>Data Logging</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleControl(this, 'Data Logging')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <h2>Reports & Analytics</h2>
            <div class="control-card">
                <h3>Generate AI-Enhanced Reports</h3>
                <div style="margin-bottom: 15px;">
                    <label>Report Type:</label>
                    <select id="report-type" style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option value="air">Air Quality Analysis</option>
                        <option value="water">Water Quality Analysis</option>
                        <option value="predictions">AI Predictions Report</option>
                        <option value="compliance">Compliance Report</option>
                        <option value="comprehensive">Comprehensive Analysis</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label>Date Range:</label>
                    <select id="date-range" style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option value="24h">Last 24 Hours</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                        <option value="90d">Last 90 Days</option>
                        <option value="1y">Last 1 Year</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label>Region:</label>
                    <select id="report-region" style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option value="current">Current Location</option>
                        <option value="all">All Locations</option>
                        <option value="custom">Custom Selection</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label>Format:</label>
                    <select id="format" style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option value="pdf">PDF</option>
                        <option value="excel">Excel</option>
                        <option value="json">JSON</option>
                        <option value="html">HTML</option>
                    </select>
                </div>
                <button onclick="generateReport()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                    Generate AI Report
                </button>
            </div>
            
            <h3 style="margin-top: 30px;">Recent Reports</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Report Name</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Region</th>
                        <th>Download</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Air Quality Weekly Report</td>
                        <td>2023-06-15</td>
                        <td>PDF</td>
                        <td>Los Angeles, CA</td>
                        <td><a href="#"><i class="fas fa-download"></i></a></td>
                    </tr>
                    <tr>
                        <td>Water Quality Analysis</td>
                        <td>2023-06-10</td>
                        <td>Excel</td>
                        <td>San Diego, CA</td>
                        <td><a href="#"><i class="fas fa-download"></i></a></td>
                    </tr>
                    <tr>
                        <td>Annual Compliance Report</td>
                        <td>2023-06-01</td>
                        <td>PDF</td>
                        <td>California</td>
                        <td><a href="#"><i class="fas fa-download"></i></a></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- AI Assistant -->
    <div class="ai-assistant">
        <div class="ai-chat-container" id="ai-chat">
            <div class="ai-chat-header">
                <span>EcoAI Assistant</span>
                <button onclick="toggleAIChat()" style="background: none; border: none; color: white; cursor: pointer;">×</button>
            </div>
            <div class="ai-chat-messages" id="ai-messages">
                <div class="ai-message assistant">
                    <div class="ai-response-header">
                        <div class="ai-avatar"><i class="fas fa-leaf"></i></div>
                        <span>EcoAI</span>
                    </div>
                    <div class="ai-response-content">
                        Hello! I'm your environmental monitoring AI assistant. How can I help you today?
                    </div>
                </div>
                <div class="ai-suggestion" onclick="sendAIMessage('What is the current air quality in my area?')">
                    <i class="fas fa-wind" style="margin-right: 5px;"></i> What is the current air quality?
                </div>
                <div class="ai-suggestion" onclick="sendAIMessage('Show me water quality trends for this location')">
                    <i class="fas fa-tint" style="margin-right: 5px;"></i> Show water quality trends
                </div>
                <div class="ai-suggestion" onclick="sendAIMessage('Explain the PM2.5 readings and health impacts')">
                    <i class="fas fa-lungs" style="margin-right: 5px;"></i> Explain PM2.5 readings
                </div>
            </div>
            <div class="ai-chat-input">
                <input type="text" id="ai-input" placeholder="Ask about environmental data..." onkeypress="handleAIKeyPress(event)">
                <button onclick="sendAIMessage(document.getElementById('ai-input').value)"><i class="fas fa-paper-plane"></i></button>
                <button class="mic-btn" id="mic-btn" onclick="toggleVoiceAssistant()"><i class="fas fa-microphone"></i></button>
            </div>
        </div>
        <button class="ai-button" id="ai-button" onclick="toggleAIChat()">
            <i class="fas fa-robot"></i>
        </button>
    </div>

    <button class="data-refresh" onclick="refreshData()" id="refresh-btn">
        <i class="fas fa-sync-alt"></i>
    </button>

    <script>
        // Enhanced Environmental Monitoring System with Voice Assistant
        class EnvironmentalAPI {
            constructor() {
                this.baseURL = 'https://api.environmental-data.com';
                this.apiKey = 'your-api-key-here';
                this.currentRegion = {
                    country: 'US',
                    state: 'CA',
                    city: 'Los Angeles'
                };
                this.sensorData = this.initializeSensorData();
                this.historicalData = this.initializeHistoricalData();
                this.mlModel = null;
                this.initializeML();
            }

            initializeSensorData() {
                return {
                    airQuality: {
                        aqi: 72,
                        pm25: 35,
                        o3: 0.045,
                        no2: 0.030,
                        co: 0.5
                    },
                    waterQuality: {
                        wqi: 94,
                        ph: 7.2,
                        dissolvedOxygen: 8.5,
                        turbidity: 1.8,
                        temperature: 22.1
                    },
                    weather: {
                        temperature: 24.5,
                        humidity: 65,
                        windSpeed: 12,
                        pressure: 1013.25
                    }
                };
            }

            initializeHistoricalData() {
                // Generate 30 days of historical data
                const historical = {
                    air: { dates: [], pm25: [], o3: [], no2: [], co: [] },
                    water: { dates: [], ph: [], dissolvedOxygen: [], turbidity: [] }
                };
                
                const now = new Date();
                for (let i = 29; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    historical.air.dates.push(date.toLocaleDateString());
                    historical.water.dates.push(date.toLocaleDateString());
                    
                    // Generate realistic fluctuations
                    historical.air.pm25.push(Math.round(30 + Math.random() * 20));
                    historical.air.o3.push(parseFloat((0.03 + Math.random() * 0.03).toFixed(3)));
                    historical.air.no2.push(parseFloat((0.02 + Math.random() * 0.02).toFixed(3)));
                    historical.air.co.push(parseFloat((0.4 + Math.random() * 0.3).toFixed(1)));
                    
                    historical.water.ph.push(parseFloat((6.8 + Math.random() * 0.8).toFixed(1)));
                    historical.water.dissolvedOxygen.push(parseFloat((7 + Math.random() * 3).toFixed(1)));
                    historical.water.turbidity.push(parseFloat((1 + Math.random() * 2).toFixed(1)));
                }
                
                return historical;
            }

            async initializeML() {
                try {
                    // Initialize TensorFlow.js model for predictions
                    this.mlModel = await tf.sequential({
                        layers: [
                            tf.layers.dense({ inputShape: [5], units: 32, activation: 'relu' }),
                            tf.layers.dense({ units: 16, activation: 'relu' }),
                            tf.layers.dense({ units: 1, activation: 'sigmoid' })
                        ]
                    });
                    
                    this.mlModel.compile({
                        optimizer: 'adam',
                        loss: 'meanSquaredError',
                        metrics: ['accuracy']
                    });
                    
                    console.log('ML Model initialized successfully');
                } catch (error) {
                    console.error('Failed to initialize ML model:', error);
                }
            }

            async fetchRealTimeData() {
                try {
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Simulate data fluctuation based on region
                    const regionFactor = this.getRegionFactor();
                    
                    this.sensorData.airQuality.aqi += (Math.random() - 0.5) * 4 * regionFactor.air;
                    this.sensorData.airQuality.pm25 += (Math.random() - 0.5) * 3 * regionFactor.air;
                    this.sensorData.waterQuality.ph += (Math.random() - 0.5) * 0.1 * regionFactor.water;
                    this.sensorData.waterQuality.dissolvedOxygen += (Math.random() - 0.5) * 0.3 * regionFactor.water;
                    
                    // Ensure values stay within realistic ranges
                    this.sensorData.airQuality.aqi = Math.max(0, Math.min(200, this.sensorData.airQuality.aqi));
                    this.sensorData.airQuality.pm25 = Math.max(0, Math.min(100, this.sensorData.airQuality.pm25));
                    this.sensorData.waterQuality.ph = Math.max(6, Math.min(8, this.sensorData.waterQuality.ph));
                    
                    return this.sensorData;
                } catch (error) {
                    console.error('Error fetching real-time data:', error);
                    return this.sensorData;
                }
            }

            getRegionFactor() {
                // Return factors that influence data based on region
                const factors = {
                    'US-CA-Los Angeles': { air: 1.2, water: 1.0 },
                    'US-CA-San Francisco': { air: 1.0, water: 0.9 },
                    'US-NY-New York': { air: 1.5, water: 1.1 },
                    'IN-MH-Mumbai': { air: 2.0, water: 1.5 },
                    'UK-LND-London': { air: 1.3, water: 0.8 }
                };
                
                const regionKey = `${this.currentRegion.country}-${this.currentRegion.state}-${this.currentRegion.city}`;
                return factors[regionKey] || { air: 1.0, water: 1.0 };
            }

            async predictAirQuality(historicalData) {
                if (!this.mlModel) return null;
                
                try {
                    // Prepare input data (simplified example)
                    const inputData = tf.tensor2d([[
                        historicalData.pm25,
                        historicalData.o3,
                        historicalData.no2,
                        historicalData.co,
                        historicalData.temperature
                    ]]);
                    
                    const prediction = this.mlModel.predict(inputData);
                    const result = await prediction.data();
                    
                    inputData.dispose();
                    prediction.dispose();
                    
                    return result[0] * 100; // Convert to AQI scale
                } catch (error) {
                    console.error('Prediction error:', error);
                    return null;
                }
            }

            detectAnomalies(data, threshold = 2) {
                const anomalies = [];
                
                // Simple z-score based anomaly detection
                const values = Object.values(data);
                const mean = values.reduce((a, b) => a + b, 0) / values.length;
                const std = Math.sqrt(values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length);
                
                for (const [key, value] of Object.entries(data)) {
                    const zScore = Math.abs((value - mean) / std);
                    if (zScore > threshold) {
                        anomalies.push({ parameter: key, value, zScore });
                    }
                }
                
                return anomalies;
            }

            setCurrentRegion(country, state, city) {
                this.currentRegion = { country, state, city };
                console.log(`Region updated to: ${city}, ${state}, ${country}`);
            }

            getHistoricalData(type, period) {
                // Return data for the requested period
                const data = JSON.parse(JSON.stringify(this.historicalData[type]));
                
                if (period === '24h') {
                    // Last 24 hours - return just the last data point
                    return {
                        dates: [data.dates[data.dates.length - 1]],
                        ...Object.keys(data).reduce((acc, key) => {
                            if (key !== 'dates') acc[key] = [data[key][data[key].length - 1]];
                            return acc;
                        }, {})
                    };
                } else if (period === '7d') {
                    // Last 7 days - return weekly data
                    return {
                        dates: data.dates.slice(-7),
                        ...Object.keys(data).reduce((acc, key) => {
                            if (key !== 'dates') acc[key] = data[key].slice(-7);
                            return acc;
                        }, {})
                    };
                } else if (period === '30d') {
                    // Last 30 days - return all data
                    return data;
                } else if (period === '90d') {
                    // Last 90 days - simulate quarterly data
                    const quarterlyData = {
                        dates: [],
                        ...Object.keys(data).reduce((acc, key) => {
                            if (key !== 'dates') acc[key] = [];
                            return acc;
                        }, {})
                    };
                    
                    // Get data for the last 90 days (we only have 30, so we'll extrapolate)
                    for (let i = 0; i < 90; i += 3) {
                        const idx = Math.min(Math.floor(i / 3), data.dates.length - 1);
                        quarterlyData.dates.push(data.dates[idx]);
                        
                        for (const key in quarterlyData) {
                            if (key !== 'dates') {
                                quarterlyData[key].push(data[key][idx] + (Math.random() - 0.5) * 0.2 * data[key][idx]);
                            }
                        }
                    }
                    
                    return quarterlyData;
                } else if (period === '1y') {
                    // Last year - simulate monthly data
                    const monthlyData = {
                        dates: [],
                        ...Object.keys(data).reduce((acc, key) => {
                            if (key !== 'dates') acc[key] = [];
                            return acc;
                        }, {})
                    };
                    
                    for (let i = 0; i < 12; i++) {
                        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        monthlyData.dates.push(monthNames[i]);
                        
                        for (const key in monthlyData) {
                            if (key !== 'dates') {
                                // Use the last data point as base with seasonal variation
                                const baseValue = data[key][data[key].length - 1];
                                const seasonalFactor = 1 + 0.2 * Math.sin(i / 2); // Simulate seasonal changes
                                monthlyData[key].push(baseValue * seasonalFactor);
                            }
                        }
                    }
                    
                    return monthlyData;
                }
                
                return data;
            }
        }

        // Initialize the API system
        const envAPI = new EnvironmentalAPI();
        let charts = {};
        let currentTimePeriod = '24h';
        let voiceRecognitionActive = false;
        let recognition;

        // Initialize voice recognition if available
        function initVoiceRecognition() {
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    console.warn('Speech recognition not supported in this browser');
                    return false;
                }
                
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('ai-input').value = transcript;
                    sendAIMessage(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    showMessage('Voice recognition error: ' + event.error);
                    toggleVoiceAssistant(false);
                };
                
                recognition.onend = function() {
                    if (voiceRecognitionActive) {
                        recognition.start();
                    }
                };
                
                return true;
            } catch (e) {
                console.error('Error initializing speech recognition:', e);
                return false;
            }
        }

        // Toggle voice assistant
        function toggleVoiceAssistant(forceState) {
            const micBtn = document.getElementById('mic-btn');
            const aiButton = document.getElementById('ai-button');
            
            if (typeof forceState !== 'undefined') {
                voiceRecognitionActive = forceState;
            } else {
                voiceRecognitionActive = !voiceRecognitionActive;
            }
            
            if (voiceRecognitionActive) {
                if (!recognition && !initVoiceRecognition()) {
                    showMessage('Voice recognition is not supported in your browser');
                    voiceRecognitionActive = false;
                    return;
                }
                
                micBtn.classList.add('listening');
                aiButton.classList.add('listening');
                recognition.start();
                showMessage('Listening... Speak now');
            } else {
                if (recognition) {
                    recognition.stop();
                }
                micBtn.classList.remove('listening');
                aiButton.classList.remove('listening');
            }
        }

        // Tab switching function
        function switchTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            
            const buttons = document.querySelectorAll('nav button');
            buttons.forEach(button => {
                button.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Update charts when switching tabs
            if (tabId === 'air-quality') {
                updateAirQualityCharts();
            } else if (tabId === 'water-quality') {
                updateWaterQualityCharts();
            } else if (tabId === 'predictions') {
                updatePredictionCharts();
            }
        }

        // Control system toggle
        function toggleControl(element, controlName) {
            const status = element.checked ? 'Active' : 'Standby';
            showMessage(`${controlName} set to ${status}`);
            
            // Simulate API call to control system
            setTimeout(() => {
                console.log(`${controlName} status changed to ${status}`);
            }, 1000);
        }

        // Report generation with AI insights
        function generateReport() {
            const reportType = document.getElementById('report-type').value;
            const dateRange = document.getElementById('date-range').value;
            const format = document.getElementById('format').value;
            const region = document.getElementById('report-region').value;
            
            let reportName = '';
            switch(reportType) {
                case 'air':
                    reportName = 'AI-Enhanced Air Quality Report';
                    break;
                case 'water':
                    reportName = 'Water Quality Analysis Report';
                    break;
                case 'predictions':
                    reportName = 'AI Predictions & Forecasting Report';
                    break;
                case 'compliance':
                    reportName = 'Regulatory Compliance Report';
                    break;
                case 'comprehensive':
                    reportName = 'Comprehensive Environmental Analysis';
                    break;
            }
            
            showMessage(`${reportName} generated successfully for ${region} region (${dateRange}) in ${format.toUpperCase()} format`);
        }

        // Message display function
        function showMessage(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `<strong>${type === 'success' ? '✅' : '⚠️'} ${type === 'success' ? 'Success' : 'Notice'}:</strong> ${message}`;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.maxWidth = '300px';
            alertDiv.style.animation = 'fadeIn 0.3s ease';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    alertDiv.remove();
                }, 300);
            }, 3000);
        }

        // Data refresh function
        async function refreshData() {
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.classList.add('rotating');
            
            try {
                const data = await envAPI.fetchRealTimeData();
                updateDashboard(data);
                
                // Update timestamp
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                
                // Perform anomaly detection
                const anomalies = envAPI.detectAnomalies(data.airQuality);
                if (anomalies.length > 0) {
                    console.log('Anomalies detected:', anomalies);
                    showAnomalyAlert(anomalies);
                }
                
                // Get AI predictions
                const prediction = await envAPI.predictAirQuality(data.airQuality);
                if (prediction) {
                    console.log('AI Prediction for next hour AQI:', prediction.toFixed(1));
                    updatePredictionChartWithNewData(prediction);
                }
                
            } catch (error) {
                console.error('Error refreshing data:', error);
                showMessage('Failed to refresh data. Please try again.', 'warning');
            } finally {
                refreshBtn.classList.remove('rotating');
            }
        }

        // Show anomaly alert
        function showAnomalyAlert(anomalies) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-warning';
            alertDiv.innerHTML = `<strong>⚠️ Anomaly Detected:</strong> Unusual readings detected in ${anomalies.map(a => a.parameter).join(', ')}`;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.left = '20px';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.maxWidth = '400px';
            alertDiv.style.animation = 'fadeIn 0.3s ease';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    alertDiv.remove();
                }, 300);
            }, 5000);
        }

        // Update dashboard with real-time data
        function updateDashboard(data) {
            // Update metric values
            document.getElementById('aqi-value').textContent = Math.round(data.airQuality.aqi);
            document.getElementById('wqi-value').textContent = Math.round(data.waterQuality.wqi);
            document.getElementById('pm25-value').textContent = Math.round(data.airQuality.pm25);
            document.getElementById('temp-value').textContent = data.weather.temperature.toFixed(1);
            
            // Update air quality metrics
            document.getElementById('air-pm25').textContent = Math.round(data.airQuality.pm25);
            document.getElementById('air-o3').textContent = data.airQuality.o3.toFixed(3);
            document.getElementById('air-no2').textContent = data.airQuality.no2.toFixed(3);
            document.getElementById('air-co').textContent = data.airQuality.co.toFixed(1);
            
            // Update water quality metrics
            document.getElementById('water-ph').textContent = data.waterQuality.ph.toFixed(1);
            document.getElementById('water-do').textContent = data.waterQuality.dissolvedOxygen.toFixed(1);
            document.getElementById('water-turbidity').textContent = data.waterQuality.turbidity.toFixed(1);
            document.getElementById('water-temp').textContent = data.waterQuality.temperature.toFixed(1);
            
            // Update charts with new data
            updateCharts(data);
        }

        // Update charts with new data
        function updateCharts(data) {
            const currentTime = new Date().toLocaleTimeString();
            
            // Update real-time chart
            if (charts.realtime) {
                charts.realtime.data.labels.push(currentTime);
                charts.realtime.data.datasets[0].data.push(data.airQuality.aqi);
                charts.realtime.data.datasets[1].data.push(data.waterQuality.wqi);
                
                // Keep only last 10 data points
                if (charts.realtime.data.labels.length > 10) {
                    charts.realtime.data.labels.shift();
                    charts.realtime.data.datasets[0].data.shift();
                    charts.realtime.data.datasets[1].data.shift();
                }
                
                charts.realtime.update('none');
            }
        }

        // Update air quality charts
        function updateAirQualityCharts() {
            const historicalData = envAPI.getHistoricalData('air', currentTimePeriod);
            
            // Update trend chart
            if (charts.airTrend) {
                charts.airTrend.data.labels = historicalData.dates;
                charts.airTrend.data.datasets[0].data = historicalData.pm25;
                charts.airTrend.data.datasets[1].data = historicalData.o3.map(v => v * 1000); // Convert to ppb
                charts.airTrend.data.datasets[2].data = historicalData.no2.map(v => v * 1000); // Convert to ppb
                charts.airTrend.update();
            }
            
            // Update history chart
            if (charts.airHistory) {
                charts.airHistory.data.labels = historicalData.dates;
                charts.airHistory.data.datasets[0].data = historicalData.pm25;
                charts.airHistory.update();
            }
            
            // Update comparison chart
            if (charts.airComparison) {
                // For comparison, show average values
                const avgPM25 = historicalData.pm25.reduce((a, b) => a + b, 0) / historicalData.pm25.length;
                const avgO3 = historicalData.o3.reduce((a, b) => a + b, 0) / historicalData.o3.length;
                const avgNO2 = historicalData.no2.reduce((a, b) => a + b, 0) / historicalData.no2.length;
                const avgCO = historicalData.co.reduce((a, b) => a + b, 0) / historicalData.co.length;
                
                charts.airComparison.data.datasets[0].data = [avgPM25, avgO3 * 1000, avgNO2 * 1000, avgCO];
                charts.airComparison.update();
            }
        }

        // Update water quality charts
        function updateWaterQualityCharts() {
            const historicalData = envAPI.getHistoricalData('water', currentTimePeriod);
            
            // Update trend chart
            if (charts.waterTrend) {
                charts.waterTrend.data.labels = historicalData.dates;
                charts.waterTrend.data.datasets[0].data = historicalData.ph;
                charts.waterTrend.data.datasets[1].data = historicalData.dissolvedOxygen;
                charts.waterTrend.data.datasets[2].data = historicalData.turbidity;
                charts.waterTrend.update();
            }
            
            // Update history chart
            if (charts.waterHistory) {
                charts.waterHistory.data.labels = historicalData.dates;
                charts.waterHistory.data.datasets[0].data = historicalData.ph;
                charts.waterHistory.update();
            }
        }

        // Update prediction charts
        function updatePredictionCharts() {
            // Model performance data
            const performanceData = {
                accuracy: [0.78, 0.82, 0.85, 0.87, 0.89],
                loss: [0.25, 0.20, 0.18, 0.15, 0.12],
                epochs: [1, 2, 3, 4, 5]
            };
            
            if (charts.modelPerformance) {
                charts.modelPerformance.data.labels = performanceData.epochs;
                charts.modelPerformance.data.datasets[0].data = performanceData.accuracy;
                charts.modelPerformance.data.datasets[1].data = performanceData.loss;
                charts.modelPerformance.update();
            }
            
            // Feature importance data
            const featureImportance = {
                features: ['PM2.5', 'O₃', 'NO₂', 'CO', 'Temperature'],
                importance: [0.35, 0.25, 0.20, 0.15, 0.05]
            };
            
            if (charts.featureImportance) {
                charts.featureImportance.data.labels = featureImportance.features;
                charts.featureImportance.data.datasets[0].data = featureImportance.importance;
                charts.featureImportance.update();
            }
        }

        // Update prediction chart with new data
        function updatePredictionChartWithNewData(prediction) {
            if (charts.prediction) {
                // Shift existing predictions
                const currentPredictions = charts.prediction.data.datasets[1].data;
                for (let i = 1; i < currentPredictions.length - 1; i++) {
                    currentPredictions[i] = currentPredictions[i + 1];
                }
                
                // Add new prediction
                currentPredictions[currentPredictions.length - 1] = prediction;
                
                // Update confidence interval
                const confidence = charts.prediction.data.datasets[2].data;
                for (let i = 1; i < confidence.length; i++) {
                    confidence[i] = currentPredictions[i] * (0.95 + Math.random() * 0.05);
                }
                
                charts.prediction.update();
            }
        }

        // Change time period for charts
        function changeTimePeriod(period) {
            currentTimePeriod = period;
            
            // Update active button
            const buttons = document.querySelectorAll('.time-selector button');
            buttons.forEach(button => {
                button.classList.remove('active');
                if (button.textContent.toLowerCase().includes(period.replace('d', ' days').replace('h', ' hours').replace('y', ' year'))) {
                    button.classList.add('active');
                }
            });
            
            // Update charts based on current tab
            const activeTab = document.querySelector('.tab-content.active').id;
            
            if (activeTab === 'air-quality') {
                updateAirQualityCharts();
            } else if (activeTab === 'water-quality') {
                updateWaterQualityCharts();
            }
        }

        // Load regions based on selection
        function loadRegions(type) {
            const countrySelect = document.getElementById(`${type}-country-select`);
            const stateSelect = document.getElementById(`${type}-state-select`);
            const citySelect = document.getElementById(`${type}-city-select`);
            
            // Simulate loading regions from API
            if (type.includes('country') && countrySelect.value) {
                // Load states for selected country
                const states = {
                    'US': ['California', 'New York', 'Texas', 'Florida'],
                    'IN': ['Maharashtra', 'Delhi', 'Karnataka'],
                    'UK': ['England', 'Scotland', 'Wales']
                };
                
                stateSelect.innerHTML = '<option value="">Select State</option>';
                if (states[countrySelect.value]) {
                    states[countrySelect.value].forEach(state => {
                        stateSelect.innerHTML += `<option value="${state.substring(0, 2).toUpperCase()}">${state}</option>`;
                    });
                }
            } else if (type.includes('state') && stateSelect.value) {
                // Load cities for selected state
                const cities = {
                    'CA': ['Los Angeles', 'San Francisco', 'San Diego'],
                    'NY': ['New York City', 'Buffalo', 'Albany'],
                    'TX': ['Houston', 'Dallas', 'Austin'],
                    'MH': ['Mumbai', 'Pune', 'Nagpur']
                };
                
                citySelect.innerHTML = '<option value="">Select City</option>';
                if (cities[stateSelect.value]) {
                    cities[stateSelect.value].forEach(city => {
                        citySelect.innerHTML += `<option value="${city.substring(0, 2).toUpperCase()}">${city}</option>`;
                    });
                }
            }
        }

        // Load data for selected region
        function loadRegionData() {
            const country = document.getElementById('country-select').value;
            const state = document.getElementById('state-select').value;
            const city = document.getElementById('city-select').value;
            
            if (!country || !state || !city) {
                showMessage('Please select country, state and city', 'warning');
                return;
            }
            
            envAPI.setCurrentRegion(country, state, city);
            showMessage(`Loading data for ${city}, ${state}, ${country}`);
            refreshData();
        }

        // Load air quality data for selected region
        function loadAirQualityData() {
            const country = document.getElementById('air-country-select').value;
            const state = document.getElementById('air-state-select').value;
            const city = document.getElementById('air-city-select').value;
            
            if (!country || !state || !city) {
                showMessage('Please select country, state and city', 'warning');
                return;
            }
            
            envAPI.setCurrentRegion(country, state, city);
            showMessage(`Loading air quality data for ${city}, ${state}, ${country}`);
            updateAirQualityCharts();
        }

        // Load water quality data for selected region
        function loadWaterQualityData() {
            const country = document.getElementById('water-country-select').value;
            const state = document.getElementById('water-state-select').value;
            const city = document.getElementById('water-city-select').value;
            
            if (!country || !state || !city) {
                showMessage('Please select country, state and city', 'warning');
                return;
            }
            
            envAPI.setCurrentRegion(country, state, city);
            showMessage(`Loading water quality data for ${city}, ${state}, ${country}`);
            updateWaterQualityCharts();
        }

        // Initialize charts when the page loads
        window.addEventListener('load', async function() {
            // Real-time dashboard chart
            const realtimeCtx = document.getElementById('realtime-chart').getContext('2d');
            charts.realtime = new Chart(realtimeCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Air Quality Index',
                            data: [],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Water Quality Index',
                            data: [],
                            borderColor: '#34a853',
                            backgroundColor: 'rgba(52, 168, 83, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 150
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Real-Time Environmental Quality Index'
                        }
                    }
                }
            });

            // Air Quality Trend Chart
            const airTrendCtx = document.getElementById('air-trend-chart').getContext('2d');
            charts.airTrend = new Chart(airTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'PM2.5 (μg/m³)',
                            data: [],
                            borderColor: '#ea4335',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'O₃ (ppb)',
                            data: [],
                            borderColor: '#fbbc05',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'NO₂ (ppb)',
                            data: [],
                            borderColor: '#1a73e8',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Air Quality Parameters Trend'
                        }
                    }
                }
            });

            // Air Quality History Chart
            const airHistoryCtx = document.getElementById('air-history-chart').getContext('2d');
            charts.airHistory = new Chart(airHistoryCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'PM2.5 (μg/m³)',
                            data: [],
                            backgroundColor: 'rgba(234, 67, 53, 0.7)',
                            borderColor: 'rgba(234, 67, 53, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Historical PM2.5 Levels'
                        }
                    }
                }
            });

            // Air Quality Comparison Chart
            const airComparisonCtx = document.getElementById('air-comparison-chart').getContext('2d');
            charts.airComparison = new Chart(airComparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['PM2.5', 'O₃', 'NO₂', 'CO'],
                    datasets: [
                        {
                            label: 'Average Concentration',
                            data: [],
                            backgroundColor: [
                                'rgba(234, 67, 53, 0.7)',
                                'rgba(251, 188, 5, 0.7)',
                                'rgba(26, 115, 232, 0.7)',
                                'rgba(52, 168, 83, 0.7)'
                            ],
                            borderColor: [
                                'rgba(234, 67, 53, 1)',
                                'rgba(251, 188, 5, 1)',
                                'rgba(26, 115, 232, 1)',
                                'rgba(52, 168, 83, 1)'
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Pollutant Comparison'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Concentration'
                            }
                        }
                    }
                }
            });

            // Water Quality Trend Chart
            const waterTrendCtx = document.getElementById('water-trend-chart').getContext('2d');
            charts.waterTrend = new Chart(waterTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'pH',
                            data: [],
                            borderColor: '#34a853',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Dissolved Oxygen (mg/L)',
                            data: [],
                            borderColor: '#1a73e8',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Turbidity (NTU)',
                            data: [],
                            borderColor: '#fbbc05',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Water Quality Parameters Trend'
                        }
                    }
                }
            });

            // Water Quality History Chart
            const waterHistoryCtx = document.getElementById('water-history-chart').getContext('2d');
            charts.waterHistory = new Chart(waterHistoryCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'pH Level',
                            data: [],
                            borderColor: '#34a853',
                            backgroundColor: 'rgba(52, 168, 83, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Historical pH Levels'
                        }
                    }
                }
            });

            // Prediction Chart
            const predictionCtx = document.getElementById('prediction-chart').getContext('2d');
            charts.prediction = new Chart(predictionCtx, {
                type: 'line',
                data: {
                    labels: ['Now', '+1h', '+2h', '+3h', '+4h', '+5h', '+6h'],
                    datasets: [
                        {
                            label: 'Actual AQI',
                            data: [72, null, null, null, null, null, null],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Predicted AQI',
                            data: [72, 75, 78, 82, 79, 76, 73],
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Confidence Interval',
                            data: [null, 73, 76, 79, 77, 74, 71],
                            borderColor: 'rgba(118, 75, 162, 0.3)',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.4,
                            fill: '+1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'AI-Powered Air Quality Predictions'
                        }
                    }
                }
            });

            // Model Performance Chart
            const modelPerformanceCtx = document.getElementById('model-performance-chart').getContext('2d');
            charts.modelPerformance = new Chart(modelPerformanceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Accuracy',
                            data: [],
                            borderColor: '#34a853',
                            backgroundColor: 'rgba(52, 168, 83, 0.1)',
                            tension: 0.4,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Loss',
                            data: [],
                            borderColor: '#ea4335',
                            backgroundColor: 'rgba(234, 67, 53, 0.1)',
                            tension: 0.4,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Model Training Performance'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Accuracy'
                            },
                            min: 0,
                            max: 1
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Loss'
                            },
                            min: 0,
                            max: 0.5,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });

            // Feature Importance Chart
            const featureImportanceCtx = document.getElementById('feature-importance-chart').getContext('2d');
            charts.featureImportance = new Chart(featureImportanceCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Feature Importance',
                            data: [],
                            backgroundColor: 'rgba(102, 126, 234, 0.7)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Feature Importance for AQI Prediction'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1
                        }
                    }
                }
            });

            // Start real-time data updates
            setInterval(refreshData, 5000); // Update every 5 seconds
            
            // Initial data load
            refreshData();
            updatePredictionCharts();
            
            // Initialize voice recognition if available
            initVoiceRecognition();
        });

        // AI Assistant Functions
        function toggleAIChat() {
            const chat = document.getElementById('ai-chat');
            chat.classList.toggle('open');
            
            // Animate the AI button
            const aiButton = document.getElementById('ai-button');
            anime({
                targets: aiButton,
                scale: [1, 1.1, 1],
                duration: 500,
                easing: 'easeInOutQuad'
            });
            
            // Scroll to bottom when opening
            if (chat.classList.contains('open')) {
                setTimeout(() => {
                    const messages = document.getElementById('ai-messages');
                    messages.scrollTop = messages.scrollHeight;
                }, 100);
            }
        }

        function handleAIKeyPress(event) {
            if (event.key === 'Enter') {
                sendAIMessage(document.getElementById('ai-input').value);
            }
        }

        async function sendAIMessage(message) {
            if (!message.trim()) return;
            
            const messagesContainer = document.getElementById('ai-messages');
            const input = document.getElementById('ai-input');
            
            // Add user message
            messagesContainer.innerHTML += `
                <div class="ai-message user">
                    ${message}
                </div>
            `;
            
            // Clear input
            input.value = '';
            
            // Show typing indicator
            messagesContainer.innerHTML += `
                <div class="ai-typing" id="ai-typing">
                    <div class="ai-typing-dot"></div>
                    <div class="ai-typing-dot"></div>
                    <div class="ai-typing-dot"></div>
                </div>
            `;
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Get AI response
            const response = await getAIResponse(message);
            
            // Remove typing indicator
            const typingIndicator = document.getElementById('ai-typing');
            if (typingIndicator) typingIndicator.remove();
            
            // Add AI response
            messagesContainer.innerHTML += `
                <div class="ai-message assistant">
                    <div class="ai-response-header">
                        <div class="ai-avatar"><i class="fas fa-leaf"></i></div>
                        <span>EcoAI</span>
                    </div>
                    <div class="ai-response-content">
                        ${marked.parse(response)}
                    </div>
                </div>
            `;
            
            // Add suggestions if this is the first response
            if (messagesContainer.querySelectorAll('.ai-message.assistant').length === 1) {
                messagesContainer.innerHTML += `
                    <div class="ai-suggestion" onclick="sendAIMessage('Show me historical air quality data')">
                        <i class="fas fa-chart-line" style="margin-right: 5px;"></i> Show historical air quality data
                    </div>
                    <div class="ai-suggestion" onclick="sendAIMessage('Compare water quality with other cities')">
                        <i class="fas fa-exchange-alt" style="margin-right: 5px;"></i> Compare water quality
                    </div>
                    <div class="ai-suggestion" onclick="sendAIMessage('Explain health impacts of current air quality')">
                        <i class="fas fa-heartbeat" style="margin-right: 5px;"></i> Health impacts
                    </div>
                `;
            }
            
            // Scroll to bottom again
            messagesContainer.scrollTop = messages.scrollHeight;
            
            // Animate the new message
            anime({
                targets: messagesContainer.lastElementChild,
                opacity: [0, 1],
                translateY: [20, 0],
                duration: 300,
                easing: 'easeOutQuad'
            });
        }

        async function getAIResponse(message) {
            // Simple keyword-based responses with more personality
            const lowerMessage = message.toLowerCase();
            const currentData = envAPI.sensorData;
            const city = envAPI.currentRegion.city;
            
            if (lowerMessage.includes('air quality') || lowerMessage.includes('aqi')) {
                const aqi = Math.round(currentData.airQuality.aqi);
                const pm25 = Math.round(currentData.airQuality.pm25);
                const category = getAQICategory(aqi);
                
                return `In ${city}, the current Air Quality Index (AQI) is **${aqi}**, which is considered **${category}**.  
                - PM2.5: **${pm25} μg/m³**  
                - Ozone (O₃): **${currentData.airQuality.o3.toFixed(3)} ppm**  
                - Nitrogen Dioxide (NO₂): **${currentData.airQuality.no2.toFixed(3)} ppm**  
                
                ${getAQIAdvice(aqi)}  
                
                *Tip: ${getRandomAITip('air')}*`;
            }
            else if (lowerMessage.includes('water quality') || lowerMessage.includes('wqi')) {
                const wqi = Math.round(currentData.waterQuality.wqi);
                const category = getWQICategory(wqi);
                
                return `For ${city}, the current Water Quality Index (WQI) is **${wqi}**, classified as **${category}**.  
                - pH level: **${currentData.waterQuality.ph.toFixed(1)}** (ideal range: 6.5-8.5)  
                - Dissolved Oxygen: **${currentData.waterQuality.dissolvedOxygen.toFixed(1)} mg/L**  
                - Turbidity: **${currentData.waterQuality.turbidity.toFixed(1)} NTU**  
                
                ${getWQIAdvice(wqi)}  
                
                *Did you know? ${getRandomWaterFact()}*`;
            }
            else if (lowerMessage.includes('temperature') || lowerMessage.includes('weather')) {
                const temp = currentData.weather.temperature.toFixed(1);
                return `The current temperature in ${city} is **${temp}°C** with **${currentData.weather.humidity}% humidity**.  
                
                *Weather impacts air quality significantly. ${getRandomWeatherImpact()}*`;
            }
            else if (lowerMessage.includes('trend') || lowerMessage.includes('chart') || lowerMessage.includes('historical')) {
                return `Here are the current trends for ${city}:  
                - **Air Quality**: ${getRandomTrend()}  
                - **Water Quality**: ${getRandomTrend()}  
                - **Temperature**: ${getRandomTrend()}  
                
                You can view detailed charts in the respective tabs. Would you like me to:  
                - Show the air quality historical data  
                - Compare water quality with other regions  
                - Explain the trends in more detail`;
            }
            else if (lowerMessage.includes('help') || lowerMessage.includes('support') || lowerMessage.includes('what can you do')) {
                return `I'm your environmental AI assistant, here to help you understand and monitor air and water quality. Here's what I can do:  
                
                🌬️ **Air Quality Information**  
                - Current AQI and pollutant levels  
                - Health recommendations based on air quality  
                - Historical trends and predictions  
                
                💧 **Water Quality Insights**  
                - Current WQI and parameters  
                - Safety information about water quality  
                - Comparison with other locations  
                
                📊 **Data Visualization**  
                - Explain charts and graphs  
                - Highlight important trends  
                - Generate reports  
                
                🎤 **Voice Commands**  
                - Click the microphone button to ask questions by voice  
                
                Try asking me:  
                - "What's the air quality in New York?"  
                - "Show me water quality trends for the past month"  
                - "Explain the health impacts of PM2.5"`;
            }
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                return `Hello there! 👋 I'm EcoAI, your environmental monitoring assistant. How can I help you today?  
                
                You might want to ask about:  
                - Current air or water quality  
                - Environmental trends in your area  
                - Health recommendations based on conditions`;
            }
            else {
                return `I'm your environmental monitoring assistant focused on ${city}. While I didn't quite understand that, I can help with:  
                
                - Air quality information and forecasts  
                - Water quality monitoring data  
                - Health recommendations based on environmental conditions  
                - Historical trends and comparisons  
                
                Try asking:  
                - "What is the current AQI?"  
                - "How's the water quality today?"  
                - "Show me historical air quality data"`;
            }
        }

        function getAQICategory(aqi) {
            aqi = parseInt(aqi);
            if (aqi <= 50) return 'Good 😊';
            if (aqi <= 100) return 'Moderate 😐';
            if (aqi <= 150) return 'Unhealthy for Sensitive Groups 🧒👵';
            if (aqi <= 200) return 'Unhealthy 😷';
            if (aqi <= 300) return 'Very Unhealthy 😨';
            return 'Hazardous ☠️';
        }

        function getAQIAdvice(aqi) {
            aqi = parseInt(aqi);
            if (aqi <= 50) return 'Air quality is satisfactory, and air pollution poses little or no risk. Perfect day for outdoor activities!';
            if (aqi <= 100) return 'Air quality is acceptable; however, there may be a moderate health concern for a very small number of people who are unusually sensitive to air pollution. Sensitive individuals should consider reducing prolonged outdoor exertion.';
            if (aqi <= 150) return 'Members of sensitive groups may experience health effects. The general public is not likely to be affected. Children, elderly, and people with respiratory or heart conditions should limit prolonged outdoor exertion.';
            if (aqi <= 200) return 'Everyone may begin to experience health effects; members of sensitive groups may experience more serious health effects. Sensitive groups should avoid outdoor exertion; everyone else should reduce prolonged exertion.';
            if (aqi <= 300) return 'Health alert: everyone may experience more serious health effects. Everyone should avoid all outdoor exertion.';
            return 'Health warnings of emergency conditions. The entire population is more likely to be affected. Avoid all outdoor activity and stay indoors with air purifiers if possible.';
        }

        function getWQICategory(wqi) {
            wqi = parseInt(wqi);
            if (wqi >= 90) return 'Excellent 💧';
            if (wqi >= 70) return 'Good 👍';
            if (wqi >= 50) return 'Fair ⚠️';
            return 'Poor 🚫';
        }

        function getWQIAdvice(wqi) {
            wqi = parseInt(wqi);
            if (wqi >= 90) return 'Water quality is excellent, suitable for all uses including drinking without treatment. Perfect for aquatic life and recreational activities.';
            if (wqi >= 70) return 'Water quality is good, suitable for most uses including drinking with standard treatment. Generally safe for swimming and aquatic life.';
            if (wqi >= 50) return 'Water quality is fair, may require additional treatment for drinking and may affect sensitive aquatic species. Caution advised for swimming.';
            return 'Water quality is poor, not suitable for drinking without extensive treatment and may harm aquatic life. Avoid contact with water.';
        }

        function getRandomTrend() {
            const trends = [
                'stable with minimal fluctuations',
                'showing a slight upward trend',
                'gradually improving over time',
                'displaying seasonal variations',
                'relatively consistent with occasional peaks',
                'showing a downward trend recently'
            ];
            return trends[Math.floor(Math.random() * trends.length)];
        }

        function getRandomAITip(type) {
            const airTips = [
                'On high AQI days, try to schedule outdoor activities for early morning when pollution levels are typically lower.',
                'Indoor plants like spider plants and peace lilies can help improve indoor air quality.',
                'Check the air quality forecast before planning outdoor exercise to protect your lungs.',
                'Using public transportation can significantly reduce your contribution to air pollution.'
            ];
            
            const waterTips = [
                'Conserving water helps maintain healthy water quality by reducing strain on treatment systems.',
                'Proper disposal of household chemicals prevents water pollution.',
                'Installing a rain barrel can help conserve water and reduce runoff pollution.',
                'Native plants in your garden can help filter rainwater naturally.'
            ];
            
            return type === 'air' ? airTips[Math.floor(Math.random() * airTips.length)] : waterTips[Math.floor(Math.random() * waterTips.length)];
        }

        function getRandomWaterFact() {
            const facts = [
                'The human body is about 60% water, highlighting the importance of clean water for health.',
                'Over 2 billion people worldwide lack access to safe drinking water.',
                'Water expands by 9% when it freezes, which is why ice floats.',
                'The average person uses about 80-100 gallons of water per day.',
                'Water regulates the Earth\'s temperature through evaporation and condensation.'
            ];
            return facts[Math.floor(Math.random() * facts.length)];
        }

        function getRandomWeatherImpact() {
            const impacts = [
                'Rain can help clear particulate matter from the air, temporarily improving air quality.',
                'Hot, sunny days can increase ozone levels, potentially worsening air quality.',
                'Wind can disperse pollutants but may also bring in pollution from other areas.',
                'Temperature inversions can trap pollutants near the ground, leading to poor air quality.'
            ];
            return impacts[Math.floor(Math.random() * impacts.length)];
        }

        console.log('🌍 Enhanced Environmental Monitoring Dashboard with Voice Assistant Ready!');
    </script>
</body>
</html>
